general:
  branches:
    ignore:
      - gh-pages

machine:
  python:
    version: 2.7.10
  node:
    version: 0.12.0

checkout:
  post:
    - git submodule sync
    - git submodule update --init

dependencies:
  cache_directories:
    - ~/.platformio
  override:
    - pip install cpplint
    # Used for deployment
    - sudo apt-get update
    - sudo apt-get install doxygen
    - npm install
    # Installing PlatformIO with pip is kind of broken. Just use their install script.
    - python -c "$(curl -fsSL https://raw.githubusercontent.com/platformio/platformio/master/scripts/get-platformio.py)"
    - platformio platforms install atmelavr
    - mkdir -p ~/.platformio/boards  # -p: no error if cached /boards already exists
    - cp tests/resources/platformio/boards/punchthrough.json ~/.platformio/boards/
    - cp -rvf hardware/bean/avr/* ~/.platformio/packages/framework-arduinoavr/

test:
  override:
    - tests/lint_all.py --lint
    - tests/compile_all.py

deployment:
  testing:  # just to make sure it works
    branch: make-docs
    commands:
      - git config user.email 'circleci@punchthrough.com'
      - git config user.name 'CircleCI Automated Build'
      - npm run gulp deploy
