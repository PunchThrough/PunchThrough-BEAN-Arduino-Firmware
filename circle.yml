machine:
  python:
    version: 2.7.10
  environment:
    PLATFORMIO_CI_SRC: tests/resources/to_compile.ino

checkout:
  post:
    - git submodule sync
    - git submodule update --init

dependencies:
  cache_directories:
    - ~/.platformio
  override:
    - pip install cpplint platformio
    - platformio platforms install atmelavr
    - mkdir -p ~/.platformio/boards  # -p: no error if cached /boards already exists
    - cp tests/resources/platformio/boards/punchthrough.json ~/.platformio/boards/
    - cp -rvf hardware/bean/avr/* ~/.platformio/packages/framework-arduinoavr/

test:
  override:
    - tests/lint_all.py --lint
    - platformio ci --board=lightblue-bean
