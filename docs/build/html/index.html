<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>Bean Arduino Firmware: Main Page</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Bean Arduino Firmware
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Bean Arduino Firmware Documentation</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This repo contains the Arduino firmware and installation files used in the LightBlue Bean project. The firmware files are based off of the Arduino firmware release version 1.0.5 and have been modified to work on the LightBlue Bean, a system that has on it a few other features, a BLE radio an accelerometer and a multicolor LED.</p>
<h1>Reading and Setting Atmega Fuses with avrdude</h1>
<p>We're going to need to set some fuses for our part in the factory. The fuse settings we need are going to set our part to basically should match the Arduino Pro defaults with brownout disabled.</p>
<ol type="1">
<li>Install avrdude. I used [<a href="http://www.obdev.at/products/crosspack/index.html">http://www.obdev.at/products/crosspack/index.html</a>](CrossPack) to do this.</li>
</ol>
<ol type="1">
<li>Read the fuses from an off the shelf ArduinoPro. Use this command after avrdude is in your path: <code>avrdude -p atmega328p -c usbtiny -U lfuse:r:-:h -U hfuse:r:-:h -U efuse:r:-:h -U lock:r:-:h</code></li>
</ol>
<ol type="1">
<li>Go to [<a href="http://www.engbedded.com/fusecalc/">http://www.engbedded.com/fusecalc/</a>](The Avr Fuse Calculator) and enter in the current state of the fuses</li>
</ol>
<ol type="1">
<li>Turn off Brown Out Detection (BOD).</li>
</ol>
<ol type="1">
<li>Calculate the new state of the fuses using the website, note for future (so no one else has to do these silly instructions)</li>
</ol>
<ol type="1">
<li>Use avrdude to write and test your new fuse settings. The command line will look something like this (except, these are guessed values: <code>avrdude -p atmega328p -c usbtiny -U lfuse:w:0xee:m -U hfuse:w:0xdc:m -U efuse:w:0xff:m</code>)</li>
</ol>
<h1>Key Files</h1>
<h2>Everything in the <code>hardware</code> directory</h2>
<p>The contents of the hardware directory should be copied into the Arduino program resources hardware directory on install. This directory contains the firmware for the LightBlue Bean, as well as the files needed for the Arduino IDE to recognize the board allow users to program it.</p>
<h2>Everything in the <code>examples</code> directory</h2>
<p>The contents of the examples directory should be copied separately on install to the examples resources in the Arduino IDE.</p>
<h2>Everything in the <code>beanModuleEmulator</code> directory</h2>
<p>This directory contains an Emulator of the 'non-Arduino' parts of the bean. This acts as a test jig for the Arduino code, and allows us to verify that things operate as expected. You can run <code>python BeanModuleEmulator.py</code> from within the beanModuleEmulator directory.</p>
<h1>Dependencies</h1>
<p>There are a few python library dependencies you'll need to make the emulator work:</p>
<ul>
<li>TkInter</li>
<li>numpy</li>
<li>pyserial</li>
<li>enum</li>
</ul>
<p>The emulator has been tested with python 2.7.6 installed by Homebrew on OSX</p>
<h1>Development</h1>
<p>During development, it is recommended to use soft links from inside your Arduino IDE resources to your repository. It will make it easier to test your work.</p>
<h1>Repo Setup</h1>
<p>This repository uses git submodules and requires a few extra steps for cloning and pulling.</p>
<h2>Clone</h2>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;$ git clone REPO_URL --recursive</div>
</div><!-- fragment --><h2>Initialize Submodules</h2>
<p>(This is unnecessary if the recursive clone works)</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;$ git submodule update --init --recursive</div>
</div><!-- fragment --><h2>Pull</h2>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;$ git pull</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;$ git submodule update --recursive</div>
</div><!-- fragment --><h1>Code Style</h1>
<p>Code in this repo should adhere to the <a href="https://google-styleguide.googlecode.com/svn/trunk/cppguide.html">Google C++ Style Guide</a>.</p>
<p>clang-format and cpplint are two tools that can help insure your code follows this standard.</p>
<h2>Installing Tools</h2>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;brew install clang-format</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;pip install cpplint</div>
</div><!-- fragment --><h2>Auto-Formatting</h2>
<p>To reformat one or more files before committing:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;clang-format -i FILE [FILE ...]</div>
</div><!-- fragment --><p><code>-i</code>: reformat code in-place. Default behavior without this flag is to reformat the file and dump the formatted output to stdout.</p>
<p>clang-format uses the <code>.clang-format</code> file to set formatting style. See the <a href="http://clang.llvm.org/docs/ClangFormat.html">clang-format docs</a> for more info.</p>
<h2>Linting</h2>
<p>To lint one or more files for errors before committing:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;cpplint FILE [FILE ...]</div>
</div><!-- fragment --><p>cpplint is configured in <code>CPPLINT.cfg</code>. That file needs to be in your working directory or one of its parents for cpplint to find it. See the <a href="https://google-styleguide.googlecode.com/svn/trunk/cpplint/cpplint.py">cpplint.py source</a> for more info on configuration options and linter filters.</p>
<h2>Entire Directories</h2>
<p>To process an entire directory of files, searching recursively for nested files:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;find &lt;DIR_PATH&gt; | xargs &lt;SOME_COMMAND&gt;</div>
</div><!-- fragment --><p>Be careful of reformatting or linting library files that you don't actually want to modify.</p>
<h1>TODO</h1>
<ul>
<li>Fix Serial.println so, like Serial.print, extra radio messages aren't sent for the newline</li>
<li>Add proper doxygen comments to relelvent parts, especially the API</li>
<li>Add features to emulator to provide better, more useful testing</li>
<li>Add more and better examples </li>
</ul>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.10
</small></address>
</body>
</html>
